<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Animation</title>
    <style>
    	* { padding: 0; margin: 0; }
    	canvas { background:"#afafb3"; display: block; margin: 0 auto; }
    </style>
</head>
<body>

<canvas id="myCanvas" width="1920" height="1080"></canvas>

<script>

class DrawObject{
    constructor(x,y,ctx,dolist){
        this.x = x;
        this.y = y;
        this.vx = 0;
        this.vy = 0;
        this.ctx = ctx;
        this.dolist = dolist;
        this.actList = [];
    }
    draw(){
        this.ctx.fillRect(this.x, this.y, 30, 30);
    }

    move(x,y,frame){
        this.frame = frame;
        this.vx = (-this.x + x)/frame;
        this.vy = (-this.y + y)/frame;
    }
    stop(frame){
        this.vx = 0;
        this.vy = 0;
        this.frame =frame;
    }
    remove(){

    }
    update(){
        this.x += this.vx;
        this.y += this.vy;
        
        if(this.frame>=0){
            this.frame--;
        }else{
            this.stop(0);
            this.next();
        }
    }
    next(){
        if(this.actList.length>=1){
            var action = this.actList.shift();
            if(action[0]==this.move){
                this.move(action[1],action[2],action[3]);   
            }
            else if(action[0]==this.end){
                this.end();
            }
            else if(action[0]==this.stop){
                this.stop(action[1]);
            }
        }
    }
    book(func,...args){
        var action = [func];
        args.forEach(a =>action.push(a));
        this.actList.push(action);
    }
    end(){
        for(var i =0;i<this.dolist.length;i++){
            if(this.dolist[i] == this){
                dolist.splice(i,1);
                break;
            }
        }
        console.log(dolist);
    }
}

class Player extends DrawObject{
    static colors = [["#4169e1"],["#ea5550"]]
    constructor(x,y,ctx,dolist,num){
        super(x,y,ctx,dolist);
        this.num = num;
        this.score = 0;
        this.coin = 10;
        this.deck = [];
    }
    draw(){
        let offset = 10;
        let card = "card : "+this.deck;
        let maxLength = 18;
        let splited = [];
        for (let i = 0; i < card.length; i+=maxLength) {
            splited.push(card.slice(i, i+maxLength));
        }
        let text =[ 
        "Player"+this.num,
        "coin : "+this.coin,
        "score : "+this.score
        ];

        splited.forEach(s=>text.push(s));

        let width = 330;
        let height = 30*text.length+offset*2;

        this.ctx.fillStyle = "white";
        this.ctx.strokeStyle = Player.colors[this.num][0];
        this.ctx.lineWidth = 5;
        this.ctx.fillRect(this.x, this.y, width, height);
        this.ctx.strokeRect(this.x, this.y, width, height);
        this.ctx.font = 'bold 30px メイリオ';
        this.ctx.textBaseline = "top";
        this.ctx.textAlign="left";
        this.ctx.lineWidth = 0;
        this.ctx.fillStyle = Player.colors[this.num][0];

        for(var i=0;i<text.length;i++){
            this.ctx.fillText(text[i],this.x+offset, this.y+i*30+offset);
        }
    }
    push(cardNum){
        this.deck.push(cardNum);
        this.deck.sort();
    }
    update(){
        super.update();
    }
    pay(num){
        this.coin -=num;
    }
}
class Coin extends DrawObject{
    draw(){
        let r = 10;
        this.ctx.beginPath();
        this.ctx.arc(this.x, this.y, r, 0 * Math.PI / 180, 360 * Math.PI / 180, false ) ;
        this.ctx.fillStyle = "#ea5550" ;
        this.ctx.fill() ;
        this.ctx.strokeStyle = "black" ;
        this.ctx.lineWidth = 3;
        this.ctx.stroke() ;
        this.ctx.strokeStyle = "#b3413d" ;
        this.ctx.lineWidth = 2;
        this.ctx.stroke() ;
    }
}
class Card extends DrawObject{
    static colors = ["#009944","#de82a7","#006eb0","#9fc24d","#6b395f","#00ac97","#ff9500","#f62e36","#b5b5ac","#009bbf","#00bb85","#00ac9b","#9c5e31","#f39700","#e60012","#9caeb7","#00a7db","#009944","#d7c447","#9b7cb6","#00ada9","#bb641d","#e85298","#0079c2","#6cbb5a","#b6007a","#e5171f","#522886","#0078ba","#019a66","#e44d93","#814721","#a9cc51","#ee7b1a","#00a0de"];
  
    constructor(x,y,ctx,dolist,num){
        super(x,y,ctx,dolist);
        this.num = num;
    }

    draw(){
        let width = 60;
        let height = 100;
        this.ctx.fillStyle = Card.colors[this.num-1];
        this.ctx.strokeStyle = 'black';
        this.ctx.lineWidth = 6
        this.ctx.strokeRect(this.x, this.y, width, height);
        this.ctx.strokeStyle = 'white';
        this.ctx.lineWidth = 5;
        this.ctx.fillRect(this.x, this.y, width, height);
        this.ctx.strokeRect(this.x, this.y, width, height);
        this.ctx.fillStyle = 'white';
        this.ctx.font = 'bold 30px メイリオ';
        this.ctx.textBaseline = "middle";
        this.ctx.textAlign="center";
        this.ctx.lineWidth = 0;
        this.ctx.fillText(this.num+"",this.x+width/2, this.y+height/2);
    }
}

var canvas = document.getElementById("myCanvas");
var ctx = canvas.getContext("2d");


dolist = [];

setInterval(tick,25);

openCard = null;
players = [new Player(0,0,ctx,dolist,0),new Player(500,0,ctx,dolist,1)]
fieldCoin = 0;
fieldCoins = [];

dolist.push(players[0]);
dolist.push(players[1]);

function tick(){
    dolist.forEach(dob =>dob.update());
    ctx.clearRect(0,0,2000,2000);
    dolist.forEach(dob =>dob.draw());
}

function open(num){
    openCard = new Card(500,500,ctx,dolist,num);
    dolist.push(openCard);
}

function pass(playerNum){
    player = players[playerNum];
    player.pay(1);
    fieldCoin+=1;
    coin = new Coin(player.x,player.y,ctx,dolist)
    //coin.move(openCard.x,openCard.y,20);
    coin.book(coin.move,openCard.x+randomInt(-20,20),openCard.y+randomInt(-20,20),20)
    dolist.push(coin);
    fieldCoins.push(coin)
    
}
function get(playerNum){
    player = players[playerNum];
    player.pay(-1*fieldCoin);
    fieldCoin = 0;
    for(var i=0;i<fieldCoins.length;i++){
        fieldCoins[i].book(fieldCoins[i].stop,i*5);
        fieldCoins[i].book(fieldCoins[i].move,player.x,player.y,20);
        fieldCoins[i].book(fieldCoins[i].end);
    }
    openCard.book(openCard.move,player.x,player.y,30);
    openCard.book(openCard.end);

    fieldCoins.splice(0);
}
function randomInt(min, max) {
  var interval = max - min + 1;

  return ~~(Math.random() * interval + min);
}



</script>

</body>
</html>

